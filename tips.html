<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agriculture Tips - Smart Agriculture Assistant</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; background: url('C:/Users/User/Desktop/Mini project/im.jpg') no-repeat center center fixed; background-size: cover; color: white; min-height: 100vh; padding-bottom: 80px; }
  header { background: rgba(0, 128, 0, 0.85); padding: 15px; }
  header marquee { font-size: 42px; font-weight: bold; color: orange; }
  nav { background: rgba(0, 77, 0, 0.9); display: flex; justify-content: center; padding: 10px 0; }
  nav a { color: white; text-decoration: none; padding: 10px 20px; margin: 0 5px; border-radius: 6px; transition: background 0.3s; font-size: 18px; }
  nav a:hover { background: #008000; }
  .tips-box { margin-top: 6px; padding: 25px; text-align: left; max-width: 450px; position: absolute; left: 20px; top: 150px; color:#1A1A1A; }
  .tips-box h3 { margin-bottom: 15px; font-size: 28px; text-align: center; color: darkgreen; }
  .tips-box li { margin-bottom: 8px; font-size: 18px; }
  .button-container { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; }
  .nav-button { padding: 14px 28px; background: orange; border: none; border-radius: 8px; color: white; font-size: 18px; cursor: pointer; }
  .nav-button:hover { background: darkorange; }
  .chatbot-button { position: fixed; bottom: 20px; right: 20px; background: orange; color: white; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 28px; cursor: pointer; box-shadow: 0px 4px 8px rgba(0,0,0,0.3); }
  .chatbot-window { display: none; position: fixed; bottom: 90px; right: 20px; width: 300px; height: 400px; background: white; color: black; border-radius: 12px; box-shadow: 0px 4px 12px rgba(0,0,0,0.4); overflow: hidden; flex-direction: column; }
  .chat-header { background: orange; color: white; padding: 10px; font-weight: bold; text-align: center; }
  .chat-messages { flex: 1; padding: 10px; overflow-y: auto; font-size: 14px; display: flex; flex-direction: column; }
  .bubble { max-width: 75%; padding: 10px 14px; margin: 6px 0; border-radius: 16px; box-shadow: 2px 2px 6px rgba(0,0,0,0.2); word-wrap: break-word; }
  .user { background: orange; color: white; margin-left: auto; }
  .bot { background: #c8f7c5; color: #333; margin-right: auto; }
  .chat-input { display: flex; border-top: 1px solid #ddd; }
  .chat-input input { flex: 1; padding: 10px; border: none; outline: none; }
  .chat-input button { padding: 10px; background: orange; border: none; cursor: pointer; color: white; font-weight: bold; }
  #yield-box { position: absolute; top: 230px; right: 230px; background: rgba(255,255,255,0.9); color: black; padding: 20px; border-radius: 10px; max-width: 300px; }
  #yield-box input, #yield-box select { width: 100%; padding: 8px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; }
  #yield-box button { padding: 10px; width: 100%; background: orange; border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; }
  #yield-result { margin-top: 10px; font-weight: bold; text-align: center; }
  #yieldChart { margin-top: 15px; border-radius:10px; background:white; }
</style>
</head>
<body>
<header>
  <marquee behavior="scroll" direction="left">üåæ Smart Agri Assistant üåæ</marquee>
</header>

<nav>
  <a href="dash.html">Home</a>
  <a href="crops.html">Crops</a>
  <a href="weather.html">Weather</a>
  <a href="tips.html">Tips</a>
  <a href="contact.html">Contact</a>
  <a href="login.html">Logout</a>
</nav>

<!-- Yield Prediction Box -->
<div id="yield-box">
  <h3>Crop Yield Prediction</h3>
  <input type="text" id="areaInput" placeholder="Enter area/district">

  <!-- UPDATED CROP INPUT -->
  <input list="cropList" id="cropSelect" placeholder="Select or type crop">
  <datalist id="cropList">
    <option value="Tomato">
    <option value="Sweet Pumpkin">
    <option value="Cucumber">
    <option value="Beans">
    <option value="Wheat">
    <option value="Rice">
    <option value="Maize">
    <option value="Groundnut">
    <option value="Cotton">
    <option value="Sugarcane">
    <option value="Ragi">
    <option value="Jowar">
  </datalist>

  <select id="seasonSelect">
    <option value="">Select Season</option>
    <option value="Kharif">Kharif (Monsoon)</option>
    <option value="Rabi">Rabi (Winter)</option>
    <option value="Summer">Summer</option>
  </select>

  <input type="number" id="rainfallInput" placeholder="Rainfall (mm)">
  <button onclick="predictYield()">Predict Yield</button>
  <div id="yield-result"></div>
  <canvas id="yieldChart" width="250" height="200"></canvas>
</div>

<div class="tips-box">
<h3>Daily Tips</h3>
<ul><b>
<li>Use drip irrigation to save water and reduce wastage.</li>
<li>Rotate crops regularly to maintain soil fertility and prevent pest buildup.</li>
<li>Check weather forecasts before spraying pesticides or fertilizers.</li>
<li>Use organic fertilizers like compost or farmyard manure to enrich soil naturally.</li>
<li>Mulch your crops to retain soil moisture and reduce weed growth.</li>
<li>Inspect plants daily for early signs of pests or disease.</li>
<li>Plant companion crops like marigold to naturally repel pests.</li>
<li>Harvest crops at the right stage for maximum yield and quality.</li>
<li>Store harvested grains and vegetables in dry, ventilated areas to prevent spoilage.</li>
<li>Maintain a farm diary to track planting, irrigation, fertilization, and harvest schedules.</li>
<li>Prune crops regularly to improve airflow and reduce disease risk.</li>
<li>Apply fertilizers based on soil testing to avoid overuse and wastage.</li>
<li>Use drip or sprinkler irrigation to optimize water usage during dry seasons.</li>
<li>Protect sensitive crops during frost or extreme heat with covers or shade nets.</li>
<li>Participate in workshops or online courses to learn modern farming techniques.</li>
<li>Keep your farming tools and equipment well-maintained for better efficiency.</li>
<li>Ensure proper spacing between plants to reduce competition for nutrients and sunlight.</li>
<li>Use pest-resistant crop varieties to reduce chemical pesticide usage.</li>
<li>Implement integrated pest management (IPM) for sustainable farming.</li>
<li>Regularly monitor soil moisture to avoid under or overwatering crops.</li></b>
</ul>
</div>

<div class="button-container">
  <button class="nav-button" onclick="window.location.href='weather.html'">Previous</button>
  <button class="nav-button" onclick="window.location.href='contact.html'">Next</button>
</div>

<button class="chatbot-button" onclick="toggleChat()">üí¨</button>
<div class="chatbot-window" id="chatbot">
  <div class="chat-header">Smart Chatbot ü§ñ</div>
  <div class="chat-messages" id="chat-messages">
    <div class="bubble bot">Hi! Ask me anything about smart farming üå±</div>
  </div>
  <div class="chat-input">
    <input type="text" id="userInput" placeholder="Type your message...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Chatbot
function toggleChat() {
  const chat = document.getElementById("chatbot");
  chat.style.display = (chat.style.display === "flex") ? "none" : "flex";
}
async function sendMessage() {
  const input = document.getElementById("userInput");
  const msg = input.value.trim();
  if (!msg) return;
  const chatBox = document.getElementById("chat-messages");
  chatBox.innerHTML += `<div class="bubble user">${msg}</div>`;
  try {
    const response = await fetch("http://127.0.0.1:5000/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: msg })
    });
    const data = await response.json();
    chatBox.innerHTML += `<div class="bubble bot">${data.reply}</div>`;
  } catch (err) {
    chatBox.innerHTML += `<div class="bubble bot">‚ùå Error: ${err}</div>`;
  }
  chatBox.scrollTop = chatBox.scrollHeight;
  input.value = "";
}

// Yield prediction
const baseYield = {
  "Tomato": 25,
  "Sweet Pumpkin": 20,
  "Cucumber": 18,
  "Beans": 15,
  "Wheat": 30,
  "Rice": 35,
  "Maize": 28,
  "Groundnut": 22,
  "Cotton": 18,
  "Sugarcane": 80,
  "Ragi": 20,
  "Jowar": 16
};

const areaFactor = {
  "Mysore": 1.0,
  "Bangalore": 0.95,
  "Mandya": 1.05,
  "Chitradurga": 0.9,
  "Hubli": 1.0,
  "Belgaum": 0.95
};

let chart;

function predictYield() {
  const area = document.getElementById("areaInput").value.trim();
  const crop = document.getElementById("cropSelect").value.trim();
  const season = document.getElementById("seasonSelect").value;
  const rainfall = parseFloat(document.getElementById("rainfallInput").value);
  const resultDiv = document.getElementById("yield-result");

  if (!area) { resultDiv.textContent = "Please enter an area."; return; }
  if (!crop) { resultDiv.textContent = "Please select or type a crop."; return; }

  let yieldEstimate = baseYield[crop] || 20; // default base for unknown crops

  if (season) {
    if (season === "Kharif") yieldEstimate *= 1.05;
    else if (season === "Rabi") yieldEstimate *= 1.1;
    else if (season === "Summer") yieldEstimate *= 0.9;
  }

  if (!isNaN(rainfall)) {
    if (rainfall < 400) yieldEstimate *= 0.85;
    else if (rainfall > 900) yieldEstimate *= 0.9;
  }

  const areaMultiplier = areaFactor[area] || 1.0;
  yieldEstimate *= areaMultiplier;
  yieldEstimate = yieldEstimate.toFixed(1);

  resultDiv.textContent = `Estimated yield of ${crop} in ${area}: ${yieldEstimate} tons/hectare`;

  const ctx = document.getElementById('yieldChart').getContext('2d');
  if (chart) chart.destroy();

  const color = yieldEstimate >= (baseYield[crop] || 20) ? 'rgba(0, 200, 0, 0.7)' : 'rgba(255, 0, 0, 0.7)';

  chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [crop],
      datasets: [{
        label: `Predicted Yield in ${area} (tons/ha)`,
        data: [yieldEstimate],
        backgroundColor: color,
        borderColor: color.replace('0.7', '1'),
        borderWidth: 1
      }]
    },
    options: {
      responsive: false,
      scales: { y: { beginAtZero: true } },
      plugins: { legend: { display: false } }
    }
  });
}
</script>
</body>
</html>
